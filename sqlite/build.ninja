cc = clang
cflags = -g -Wall -Werror -std=c99 -pedantic
builddir = out/obj
builddir_cli = out/obj/cli

rule cc
  command = $cc $cflags $includes -c $in -o $out

rule link
  command = $cc $ldflags -o $out $in $libs

build $builddir/html.o: cc cgi/html.c

build $builddir/create_users_db.o: cc cgi/create_users_db.c
build cgi-bin/create_users_db: link $builddir/html.o $builddir/create_users_db.o
  libs = -lsqlite3

build $builddir/create_user_table.o: cc cgi/create_user_table.c
build cgi-bin/create_user_table: link $builddir/html.o $builddir/create_user_table.o
  libs = -lsqlite3

build $builddir/insert_into_user_table.o: cc cgi/insert_into_user_table.c
build cgi-bin/insert_into_user_table: link $builddir/html.o $builddir/insert_into_user_table.o
  libs = -lsqlite3

build $builddir/select_from_user_table.o: cc cgi/select_from_user_table.c
build cgi-bin/select_from_user_table: link $builddir/html.o $builddir/select_from_user_table.o
  libs = -lsqlite3

build $builddir/update_user_table.o: cc cgi/update_user_table.c
build cgi-bin/update_user_table: link $builddir/html.o $builddir/update_user_table.o
  libs = -lsqlite3

build $builddir/delete_from_user_table.o: cc cgi/delete_from_user_table.c
build cgi-bin/delete_from_user_table: link $builddir/html.o $builddir/delete_from_user_table.o
  libs = -lsqlite3

build $builddir/users.o: cc cgi/users.c
build users.cgi: link $builddir/html.o $builddir/users.o
  libs = -lsqlite3

# CLI
build $builddir/sqlite3.o: cc deps/sqlite3.c
  cflags =

build $builddir_cli/db.o: cc cli/db.c
  includes = -I.

build $builddir_cli/user.o: cc cli/user.c
  includes = -I.

build $builddir_cli/create.o: cc cli/create.c
  includes = -I.
build out/create: link $builddir/sqlite3.o $builddir_cli/db.o $
$builddir_cli/user.o $builddir_cli/create.o
  libs = -lpthread -ldl

build $builddir_cli/insert.o: cc cli/insert.c
  includes = -I.
build out/insert: link $builddir/sqlite3.o $builddir_cli/db.o $
$builddir_cli/user.o $builddir_cli/insert.o
  libs = -lpthread -ldl

build $builddir_cli/list.o: cc cli/list.c
  includes = -I.
build out/list: link $builddir/sqlite3.o $builddir_cli/db.o $
$builddir_cli/user.o $builddir_cli/list.o
  libs = -lpthread -ldl

build $builddir_cli/update.o: cc cli/update.c
  includes = -I.
build out/update: link $builddir/sqlite3.o $builddir_cli/db.o $
$builddir_cli/user.o $builddir_cli/update.o
  libs = -lpthread -ldl

build $builddir_cli/delete.o: cc cli/delete.c
  includes = -I.
build out/delete: link $builddir/sqlite3.o $builddir_cli/db.o $
$builddir_cli/user.o $builddir_cli/delete.o
  libs = -lpthread -ldl

build $builddir_cli/all.o: cc cli/all.c
  includes = -I.
build out/all: link $builddir/sqlite3.o $builddir_cli/db.o $
$builddir_cli/user.o $builddir_cli/all.o
  libs = -lpthread -ldl
