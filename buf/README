This was copied from Go's src/cmd/dist/ and modified by me.

